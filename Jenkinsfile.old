pipeline {
    agent any
    stages {
        stage('Checkout from Git') {
            steps {
                git branch: 'jenkins-sca-dast-owasp-zap', url: 'https://github.com/awanmbandi/realworld-microservice-project.git'
            }
        }
        stage('Run OWASP ZAP') {
            steps {
                sshagent(['OWASP-Zap-Credential']) {
                    sh 'ssh -o StrictHostKeyChecking=no ubuntu@3.17.14.247 "docker run -t owasp/zap2docker-stable zap-baseline.py -t http://3.138.106.68:3000/" || true'
                }
            }
        }
    }
}
